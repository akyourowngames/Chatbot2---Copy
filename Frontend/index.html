<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KAI OS | Tactical Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- HLS.js for Anime Streaming -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@400;500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dim: rgba(99, 102, 241, 0.1);
            --primary-glow: rgba(99, 102, 241, 0.5);
            --accent: #00f0ff;
            --danger: #ff003c;
            --surface-dark: #050505;
            --surface-panel: #0a0a0c;
            --border: rgba(255, 255, 255, 0.1);
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
            --font-mono: 'JetBrains Mono', monospace;
        }

        /* Typing cursor blink animation */
        @keyframes blink {

            0%,
            50% {
                opacity: 1;
            }

            51%,
            100% {
                opacity: 0;
            }
        }

        .typing-cursor {
            animation: blink 0.7s infinite;
        }

        * {
            -webkit-tap-highlight-color: transparent;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) transparent;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        /* Accessibility: Reduced motion */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--surface-dark);
            color: var(--text-main);
            overflow: hidden;
            height: 100dvh;
            width: 100vw;
            position: fixed;
        }

        /* Global image responsiveness */
        img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        .scan-line {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent 50%, rgba(0, 0, 0, 0.3) 51%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 60;
            opacity: 0.1;
        }

        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 55;
            opacity: 0.3;
        }

        .ambient-glow {
            position: fixed;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.05) 0%, transparent 70%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 0;
            pointer-events: none;
        }

        .cyber-grid {
            position: fixed;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background-image: linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            transform: perspective(500px) rotateX(60deg);
            animation: gridMove 40s linear infinite;
            z-index: 0;
            pointer-events: none;
            mask-image: radial-gradient(circle at 50% 50%, black 0%, transparent 80%);
        }

        @keyframes gridMove {
            0% {
                transform: perspective(500px) rotateX(60deg) translateY(0);
            }

            100% {
                transform: perspective(500px) rotateX(60deg) translateY(50px);
            }
        }

        .cut-corner {
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }

        .cut-corner-br {
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%);
        }

        .cut-corner-top {
            clip-path: polygon(8px 0, 100% 0, 100% 100%, 0 100%, 0 8px);
        }

        .glitch-text {
            position: relative;
            font-family: var(--font-mono);
        }

        .sidebar-bg {
            background: rgba(5, 5, 7, 0.98);
            border-right: 1px solid var(--border);
            backdrop-filter: blur(20px);
        }

        .msg-block {
            animation: messageAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            padding: 20px;
            margin-bottom: 24px;
            background: rgba(255, 255, 255, 0.015);
            border: 1px solid var(--border);
            position: relative;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.98);
                filter: blur(4px);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        .msg-block.assistant {
            border-left: 2px solid var(--primary);
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.03) 0%, transparent 100%);
        }

        .msg-block.user {
            border-right: 2px solid rgba(255, 255, 255, 0.2);
            background: linear-gradient(-90deg, rgba(255, 255, 255, 0.01) 0%, transparent 100%);
        }

        .tactical-console {
            background: rgba(8, 8, 10, 0.95);
            border: 1px solid var(--border);
            backdrop-filter: blur(25px);
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.6);
        }

        .console-input {
            background: transparent;
            border: none;
            color: white;
            font-family: var(--font-mono);
            width: 100%;
            resize: none;
            outline: none;
        }

        .auth-panel {
            background: rgba(10, 10, 12, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-dot.active {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
        }

        .status-dot.busy {
            background: var(--primary);
            box-shadow: 0 0 10px var(--primary);
        }

        .hud-border-tl {
            position: absolute;
            top: 0;
            left: 0;
            width: 12px;
            height: 12px;
            border-top: 1px solid var(--primary);
            border-left: 1px solid var(--primary);
            opacity: 0.6;
        }

        .hud-border-tr {
            position: absolute;
            top: 0;
            right: 0;
            width: 12px;
            height: 12px;
            border-top: 1px solid var(--primary);
            border-right: 1px solid var(--primary);
            opacity: 0.6;
        }

        .hud-border-bl {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 12px;
            height: 12px;
            border-bottom: 1px solid var(--primary);
            border-left: 1px solid var(--primary);
            opacity: 0.6;
        }

        .hud-border-br {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            border-bottom: 1px solid var(--primary);
            border-right: 1px solid var(--primary);
            opacity: 0.6;
        }

        /* Overlay Mode Styles */
        body.overlay-mode {
            background: transparent !important;
        }

        body.overlay-mode .cyber-grid,
        body.overlay-mode .noise-overlay,
        body.overlay-mode .ambient-glow,
        body.overlay-mode .scan-line {
            display: none !important;
        }

        body.overlay-mode #main-interface header {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            height: 48px;
        }

        body.overlay-mode #chat-container {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            margin: 0;
        }

        body.overlay-mode .tactical-console {
            background: rgba(5, 5, 7, 0.9);
            backdrop-filter: blur(20px);
        }

        @media (max-width: 1024px) {
            #sidebar {
                transform: translateX(-100%);
            }

            #sidebar.open {
                transform: translateX(0);
            }
        }

        /* ========== KILLER UI ENHANCEMENTS ========== */

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 16px 20px;
            margin-bottom: 24px;
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.05) 0%, transparent 100%);
            border: 1px solid var(--border);
            border-left: 2px solid var(--primary);
        }

        .typing-indicator .dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: typingWave 1.4s ease-in-out infinite;
        }

        .typing-indicator .dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-indicator .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingWave {

            0%,
            60%,
            100% {
                transform: translateY(0) scale(1);
                opacity: 0.6;
            }

            30% {
                transform: translateY(-8px) scale(1.2);
                opacity: 1;
            }
        }

        /* Equalizer Animation for Spotify */
        .equalizer-bars {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 16px;
        }

        .equalizer-bars .bar {
            width: 3px;
            background: linear-gradient(to top, #1db954, #1ed760);
            border-radius: 1px;
            animation: equalize 0.8s infinite ease-in-out;
        }

        .equalizer-bars .bar:nth-child(1) {
            animation-delay: -0.4s;
            height: 60%;
        }

        .equalizer-bars .bar:nth-child(2) {
            animation-delay: -0.2s;
            height: 100%;
        }

        .equalizer-bars .bar:nth-child(3) {
            animation-delay: -0.3s;
            height: 40%;
        }

        .equalizer-bars .bar:nth-child(4) {
            animation-delay: -0.1s;
            height: 80%;
        }

        @keyframes equalize {

            0%,
            100% {
                transform: scaleY(0.3);
            }

            50% {
                transform: scaleY(1);
            }
        }

        /* Enhanced Message Hover */
        .msg-block {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .msg-block:hover {
            background: rgba(255, 255, 255, 0.025);
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.05);
        }

        .msg-block.assistant:hover {
            border-left-color: var(--primary);
            box-shadow: -4px 0 20px rgba(99, 102, 241, 0.1), 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        /* Card Hover Effects - Integration Cards */
        .mt-4.rounded-xl,
        .mt-4.rounded-2xl {
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .mt-4.rounded-xl:hover,
        .mt-4.rounded-2xl:hover {
            transform: translateY(-4px) scale(1.01);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(99, 102, 241, 0.2);
        }

        /* Glowing Input Focus */
        .tactical-console:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.15), 0 -10px 40px rgba(0, 0, 0, 0.6);
            animation: inputPulse 2s ease-in-out infinite;
        }

        @keyframes inputPulse {

            0%,
            100% {
                box-shadow: 0 0 30px rgba(99, 102, 241, 0.15), 0 -10px 40px rgba(0, 0, 0, 0.6);
            }

            50% {
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.25), 0 -10px 40px rgba(0, 0, 0, 0.6);
            }
        }

        /* Premium Execute Button */
        #executeBtn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        #executeBtn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        #executeBtn::after {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, transparent, rgba(99, 102, 241, 0.3), transparent);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        #executeBtn:hover::before {
            left: 100%;
        }

        #executeBtn:hover::after {
            opacity: 1;
            animation: buttonGlow 2s ease-in-out infinite;
        }

        #executeBtn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
        }

        #executeBtn:active {
            transform: scale(0.98);
        }

        @keyframes buttonGlow {

            0%,
            100% {
                filter: brightness(1);
            }

            50% {
                filter: brightness(1.3);
            }
        }

        /* ========== PHASE 2 UI POLISH ========== */

        /* Notification/Toast Animations */
        .notification,
        .toast {
            animation: toastSlideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes toastSlideIn {
            from {
                transform: translateX(100%) scale(0.8);
                opacity: 0;
            }

            to {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }

        /* Focus Visible States for Accessibility */
        button:focus-visible {
            outline: 2px solid #6366f1;
            outline-offset: 2px;
        }

        input:focus,
        textarea:focus,
        input:focus-visible,
        textarea:focus-visible {
            outline: none !important;
        }

        /* Button Press Feedback */
        button:active:not(:disabled) {
            transform: scale(0.96);
            transition: transform 0.1s;
        }


        /* Spotify Player - Subtle styling */
        .spotify-player-card {
            border: 1px solid rgba(99, 102, 241, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .spotify-player-card:hover {
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        /* PDF Preview Card Glow */
        .pdf-preview-card {
            transition: all 0.3s ease;
        }

        .pdf-preview-card:hover {
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.15);
        }

        /* ========== RESPONSIVE: LARGE SCREENS (1440px+) ========== */
        @media (min-width: 1440px) {
            #chat-container {
                padding-left: 15%;
                padding-right: 15%;
            }

            #messages-list {
                max-width: 900px;
            }

            .msg-block {
                padding: 28px;
                margin-bottom: 32px;
            }

            .tactical-console {
                max-width: 900px;
            }

            #welcome-screen h2 {
                font-size: 5rem;
            }

            #welcome-screen .grid {
                gap: 1.5rem;
            }

            /* Better spacing for source cards */
            .source-cards-container {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 14px;
            }

            /* Larger integration cards */
            .mt-4.rounded-xl,
            .mt-4.rounded-2xl {
                margin-top: 24px;
            }
        }

        /* ========== RESPONSIVE: EXTRA LARGE (1920px+) ========== */
        @media (min-width: 1920px) {
            #chat-container {
                padding-left: 20%;
                padding-right: 20%;
            }

            #messages-list {
                max-width: 1000px;
            }

            .tactical-console {
                max-width: 1000px;
            }

            .msg-block {
                font-size: 1.05rem;
            }

            /* Ultra-wide screen optimizations */
            .source-cards-container {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 16px;
            }

            /* Bigger text for large screens */
            .source-title {
                font-size: 14px;
            }

            .source-domain {
                font-size: 11px;
            }
        }

        /* ========== RESPONSIVE: TABLETS (768px - 1024px) ========== */
        @media (max-width: 1024px) and (min-width: 768px) {
            #chat-container {
                padding-left: 2rem;
                padding-right: 2rem;
            }

            .msg-block {
                padding: 16px;
                margin-bottom: 20px;
            }

            #welcome-screen h2 {
                font-size: 3rem;
            }

            #welcome-screen .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ========== RESPONSIVE: MOBILE (max-width: 768px) ========== */
        @media (max-width: 768px) {

            /* Main Layout */
            body {
                font-size: 14px;
            }

            /* Header */
            header {
                height: 56px !important;
                padding-left: 12px !important;
                padding-right: 12px !important;
            }

            header .flex-col span:first-child {
                font-size: 10px;
            }

            /* Hide some header elements on mobile */

            /* Chat Container */
            #chat-container {
                padding: 12px !important;
            }

            /* Messages */
            .msg-block {
                padding: 14px;
                margin-bottom: 16px;
                border-radius: 8px;
            }

            .msg-block .mb-3 {
                margin-bottom: 8px;
            }

            #messages-list {
                max-width: 100%;
                padding-bottom: 20px;
            }

            /* Welcome Screen */
            #welcome-screen {
                padding: 16px !important;
            }

            #welcome-screen h2 {
                font-size: 2rem !important;
                line-height: 1.1;
            }

            #welcome-screen .grid {
                grid-template-columns: 1fr !important;
                gap: 12px;
            }

            #welcome-screen .grid button {
                padding: 16px !important;
            }

            #welcome-screen .w-24 {
                width: 64px;
                height: 64px;
            }

            #welcome-screen .w-24 i {
                width: 28px;
                height: 28px;
            }

            /* Input Console */
            .tactical-console {
                margin: 0 8px;
                border-radius: 12px;
            }

            .tactical-console .p-4 {
                padding: 12px !important;
                gap: 8px !important;
            }

            .tactical-console textarea {
                font-size: 14px;
                min-height: 44px;
            }

            .tactical-console button {
                min-height: 44px;
                min-width: 44px;
            }

            /* Execute Button */
            .tactical-console button[onclick="sendMessage()"] {
                padding: 0 16px !important;
                font-size: 9px !important;
            }

            /* Bottom Padding Area */
            main>.p-6 {
                padding: 12px !important;
            }

            /* Spotify Player */
            .spotify-player-card {
                max-width: 100% !important;
                margin-left: 0;
                margin-right: 0;
            }

            .spotify-player-card iframe {
                height: 80px !important;
            }

            /* PDF Preview */
            .pdf-preview-card {
                height: 300px !important;
            }

            /* Auth Panel */
            .auth-panel {
                margin: 16px;
                padding: 24px !important;
            }

            /* Code blocks */
            .code-container {
                font-size: 12px;
            }

            pre code {
                font-size: 11px !important;
            }

            /* Image responsiveness - ensure generated images fit mobile screens */
            .markdown-body img,
            .msg-block img {
                max-width: 100% !important;
                height: auto !important;
                object-fit: contain;
                border-radius: 8px;
            }

            /* Ensure NASA card images are responsive */
            .aspect-video img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            /* Improved card responsiveness */
            .mt-4.rounded-xl,
            .mt-4.rounded-2xl {
                margin-left: 0 !important;
                margin-right: 0 !important;
                max-width: 100% !important;
            }

            /* Weather, news, and other integration cards */
            .mt-4.p-6,
            .mt-4.p-4 {
                padding: 12px !important;
            }

            /* Grid layouts on mobile - force single column */
            .grid {
                grid-template-columns: 1fr !important;
            }

            .grid-cols-2,
            .grid-cols-3 {
                grid-template-columns: 1fr !important;
            }

            /* NASA card aspect ratio fix */
            .aspect-video {
                aspect-ratio: 16/9 !important;
            }
        }

        /* ========== RESPONSIVE: SMALL MOBILE (max-width: 480px) ========== */
        @media (max-width: 480px) {

            /* Even smaller text */
            body {
                font-size: 13px;
            }

            header {
                height: 52px !important;
            }

            #welcome-screen h2 {
                font-size: 1.75rem !important;
            }

            /* Small text adjustments */

            .msg-block {
                padding: 12px;
            }

            /* Reduce icon sizes */
            #welcome-screen .w-24 {
                width: 56px;
                height: 56px;
            }

            /* Make buttons more tappable */
            button,
            a.px-3 {
                min-height: 44px;
                min-width: 44px;
            }

            /* Simplify welcome grid */
            #welcome-screen .grid button p {
                font-size: 9px;
            }
        }

        /* ========== TOUCH OPTIMIZATIONS ========== */
        @media (hover: none) and (pointer: coarse) {

            /* Remove hover effects on touch devices */
            .msg-block:hover,
            .spotify-player-card:hover,
            .pdf-preview-card:hover {
                transform: none;
            }

            /* Larger touch targets */
            button,
            a,
            input,
            textarea {
                min-height: 44px;
            }

            /* Remove animations that can cause jank */
            .cyber-grid {
                animation: none;
            }

            /* Disable scanlines on mobile for performance */
            .scan-line {
                display: none;
            }

            /* Larger tap targets for source cards */
            .source-card {
                padding: 16px;
                min-height: 60px;
            }

            /* Disable hover effects that don't work on touch */
            .source-card:hover {
                transform: none !important;
                border-color: rgba(139, 92, 246, 0.15);
            }

            /* Better touch feedback */
            .source-card:active {
                background: rgba(139, 92, 246, 0.15);
                transform: scale(0.98);
            }
        }

        /* ========== SAFE AREA INSETS (Notched phones) ========== */
        @supports (padding: max(0px)) {
            .tactical-console {
                padding-bottom: max(12px, env(safe-area-inset-bottom));
            }

            main>.p-6 {
                padding-bottom: max(12px, env(safe-area-inset-bottom));
            }

            header {
                padding-top: max(0px, env(safe-area-inset-top));
            }
        }

        /* ========== LANDSCAPE MOBILE ========== */
        @media (max-height: 500px) and (orientation: landscape) {
            #welcome-screen {
                padding: 8px !important;
            }

            #welcome-screen h2 {
                font-size: 1.5rem !important;
                margin-bottom: 8px;
            }

            #welcome-screen .grid {
                grid-template-columns: repeat(3, 1fr) !important;
            }

            header {
                height: 44px !important;
            }

            .tactical-console .p-4 {
                padding: 8px !important;
            }
        }

        /* ========== PRINT STYLES ========== */
        @media print {

            .cyber-grid,
            .noise-overlay,
            .ambient-glow,
            .scan-line,
            #sidebar,
            .tactical-console,
            header button {
                display: none !important;
            }

            body {
                background: white;
                color: black;
            }

            .msg-block {
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }
        }

        /* ========== SETTINGS MODAL STYLES ========== */
        .settings-modal {
            position: fixed;
            inset: 0;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .settings-modal.open {
            opacity: 1;
            pointer-events: auto;
        }

        .settings-modal .backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }

        .settings-modal .panel {
            position: relative;
            z-index: 10;
            display: flex;
            height: 100%;
            max-width: 1400px;
            margin: 0 auto;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .settings-modal.open .panel {
            transform: translateY(0);
        }

        .settings-sidebar {
            width: 280px;
            background: #050505;
            border-right: 1px solid rgba(99, 102, 241, 0.15);
            display: flex;
            flex-direction: column;
        }

        .settings-content {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            background: #000;
        }

        .settings-nav-item {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #71717a;
            border-left: 2px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
            background: none;
            border-right: none;
            border-top: none;
            border-bottom: none;
        }

        .settings-nav-item:hover {
            color: #a5b4fc;
            background: rgba(99, 102, 241, 0.03);
        }

        .settings-nav-item.active {
            color: #a5b4fc;
            background: rgba(99, 102, 241, 0.08);
            border-left-color: #6366f1;
        }

        .cyber-input {
            width: 100%;
            background: rgba(15, 15, 20, 0.8);
            border: none;
            border-bottom: 1px solid #6366f1;
            padding: 12px;
            font-size: 12px;
            color: #c7d2fe;
            font-weight: 600;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .cyber-input:focus {
            background: rgba(30, 30, 40, 0.9);
            border-bottom: 2px solid #818cf8;
            outline: none;
        }

        .settings-toggle {
            width: 48px;
            height: 24px;
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
            background: #27272a;
        }

        .settings-toggle.on {
            background: #6366f1;
        }

        .settings-toggle .thumb {
            position: absolute;
            top: 4px;
            left: 4px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 9999px;
            transition: left 0.2s ease;
        }

        .settings-toggle.on .thumb {
            left: 28px;
        }

        .stat-widget {
            background: #000;
            border: 1px solid rgba(99, 102, 241, 0.15);
            padding: 16px;
            transition: all 0.3s ease;
        }

        .stat-widget:hover {
            border-color: rgba(99, 102, 241, 0.4);
        }

        .section-fade-in {
            animation: settingsFadeIn 0.4s ease forwards;
        }

        @keyframes settingsFadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {}
        }

        /* Mobile Close Button - Hidden on desktop */
        .settings-mobile-close {
            display: none;
            position: fixed;
            top: 12px;
            right: 12px;
            width: 40px;
            height: 40px;
            z-index: 200;
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.4);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            align-items: center;
            justify-content: center;
        }

        .settings-mobile-close:hover {
            background: rgba(99, 102, 241, 0.4);
            transform: scale(1.05);
        }

        .settings-mobile-close:active {
            transform: scale(0.95);
        }

        @media (max-width: 768px) {
            .settings-mobile-close {
                display: flex;
            }
        }

        /* ========== SETTINGS MODAL RESPONSIVE ========== */

        /* Mobile: Stacked layout with horizontal tabs */
        @media (max-width: 768px) {
            .settings-modal .panel {
                flex-direction: column !important;
                max-width: 100% !important;
                height: 100%;
            }

            /* Sidebar becomes top header + horizontal scrollable tabs */
            .settings-sidebar {
                width: 100% !important;
                height: auto !important;
                min-height: auto !important;
                max-height: none !important;
                border-right: none !important;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                background: #0a0a0c !important;
                flex-shrink: 0;
                display: flex !important;
                flex-direction: column !important;
            }

            /* Hide the large header section on mobile */
            .settings-sidebar>.p-6.border-b {
                display: none !important;
            }

            /* Nav container - horizontal scrollable tabs */
            .settings-sidebar nav {
                display: flex !important;
                flex-direction: column !important;
                padding: 0 !important;
                overflow: visible !important;
                height: auto !important;
                flex: none !important;
            }

            /* Mobile header row with logo and close button */
            .settings-sidebar nav::before {
                content: 'KAI SETTINGS';
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 12px 16px;
                font-size: 11px;
                font-weight: 700;
                letter-spacing: 0.15em;
                color: #a5b4fc;
                background: linear-gradient(180deg, rgba(99, 102, 241, 0.1) 0%, transparent 100%);
                border-bottom: 1px solid rgba(99, 102, 241, 0.15);
            }

            /* Section headers (Management, Systems, Advanced) - HIDE on mobile */
            .settings-sidebar nav>div:not([class]):not(:last-child),
            .settings-sidebar nav>div[class*="text-zinc"],
            .settings-sidebar nav>.text-\\[10px\\] {
                display: none !important;
            }

            /* Nav items container - horizontal scroll */
            .settings-sidebar nav {
                flex-direction: row !important;
                flex-wrap: nowrap;
                overflow-x: auto !important;
                padding: 0 !important;
                gap: 0 !important;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }

            .settings-sidebar nav::-webkit-scrollbar {
                display: none;
            }

            /* Each nav button as a horizontal tab */
            .settings-nav-item {
                white-space: nowrap;
                padding: 14px 18px !important;
                height: auto !important;
                min-height: 48px;
                border-left: none !important;
                border-bottom: 3px solid transparent !important;
                flex-shrink: 0;
                display: flex !important;
                align-items: center;
                justify-content: center !important;
                color: rgba(255, 255, 255, 0.6);
                font-size: 9px !important;
                letter-spacing: 0.1em !important;
            }

            /* Hide chevron icons on mobile */
            .settings-nav-item>i[data-lucide="chevron-right"] {
                display: none !important;
            }

            /* Make icon + text stay together */
            .settings-nav-item>div {
                display: flex;
                align-items: center;
                gap: 6px;
            }

            .settings-nav-item.active {
                border-bottom-color: #6366f1 !important;
                background: rgba(99, 102, 241, 0.15) !important;
                color: #fff !important;
            }

            /* Close settings button - make it a floating X */
            .settings-sidebar nav>div.pt-12 {
                display: none !important;
            }

            /* Footer version info - hide on mobile */
            .settings-sidebar>.p-4.border-t {
                display: none !important;
            }

            /* Add mobile close button via CSS (will add JS handler) */
            .settings-modal .panel::before {
                content: 'âœ•';
                position: fixed;
                top: 10px;
                right: 10px;
                width: 36px;
                height: 36px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(99, 102, 241, 0.2);
                border: 1px solid rgba(99, 102, 241, 0.3);
                border-radius: 8px;
                color: white;
                font-size: 16px;
                z-index: 100;
                cursor: pointer;
                pointer-events: auto;
            }

            /* Content takes remaining space */
            .settings-content {
                width: 100% !important;
                max-width: 100% !important;
                padding: 16px !important;
                overflow-y: auto;
                flex: 1;
                min-height: 0;
            }

            /* Settings header - simplify on mobile */
            .settings-content>.flex.items-center.justify-between.mb-8 {
                margin-bottom: 16px !important;
            }

            .settings-content h2#settings-tab-title {
                font-size: 12px !important;
                letter-spacing: 0.15em !important;
            }

            /* Avatar section - STACK vertically on mobile */
            .settings-section .flex.items-start.gap-8 {
                flex-direction: column !important;
                align-items: center !important;
                gap: 20px !important;
            }

            /* Avatar container - center and slightly smaller */
            .settings-section .flex.items-start.gap-8>.relative.group {
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .settings-section .flex.items-start.gap-8>.relative.group>div:first-child {
                width: 100px !important;
                height: 100px !important;
            }

            /* Form section - full width */
            .settings-section .flex.items-start.gap-8>.flex-1 {
                width: 100% !important;
            }

            /* Optimize form inputs for mobile */
            .cyber-input {
                font-size: 16px !important;
                padding: 14px 12px !important;
                font-weight: 500 !important;
                text-transform: none !important;
                border-radius: 6px;
                min-height: 50px;
            }

            .cyber-input::placeholder {
                font-size: 13px;
                color: rgba(255, 255, 255, 0.3);
            }

            /* Force single column for ALL grids */
            .settings-section .grid,
            .settings-section .grid-cols-2,
            .settings-section .grid-cols-3 {
                grid-template-columns: 1fr !important;
                gap: 14px !important;
            }

            /* Settings toggle buttons - larger touch targets */
            .settings-toggle {
                width: 56px !important;
                height: 28px !important;
            }

            .settings-toggle .thumb {
                width: 20px !important;
                height: 20px !important;
                top: 4px !important;
                left: 4px !important;
            }

            .settings-toggle.on .thumb {
                left: 32px !important;
            }

            /* Settings section headers */
            .settings-content h3 {
                font-size: 11px !important;
                margin-top: 20px !important;
                padding-top: 20px !important;
            }

            /* Dropdown selects - larger and touch-friendly */
            select,
            select.cyber-input {
                font-size: 15px !important;
                padding: 14px 12px !important;
                min-height: 50px !important;
                text-transform: none !important;
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236366f1' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
                background-repeat: no-repeat;
                background-position: right 12px center;
                background-size: 18px;
                padding-right: 44px !important;
                appearance: none;
                -webkit-appearance: none;
            }

            /* All buttons larger */
            .settings-content button:not(.settings-nav-item) {
                min-height: 50px !important;
                font-size: 12px !important;
                padding: 14px 20px !important;
            }

            /* Save button - sticky at bottom */
            .settings-section button[onclick*="saveSettings"],
            .settings-section button:last-of-type {
                position: sticky;
                bottom: 0;
                margin-top: 20px;
                width: 100%;
                background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            }

            /* Linked info banner - smaller on mobile */
            .settings-section>.flex.items-center.gap-3.p-3 {
                padding: 10px !important;
            }

            .settings-section>.flex.items-center.gap-3.p-3 p {
                font-size: 10px !important;
            }

            /* Textarea inputs */
            textarea.cyber-input {
                min-height: 100px !important;
            }
        }

        /* Tablet: Sidebar visible but narrower */
        @media (min-width: 769px) and (max-width: 1024px) {
            .settings-sidebar {
                width: 200px !important;
            }

            .settings-nav-item {
                font-size: 9px;
                padding: 10px 12px;
            }

            .settings-content {
                padding: 1.5rem;
            }
        }

        /* Large screens: Wider sidebar, more padding */
        @media (min-width: 1440px) {
            .settings-modal .panel {
                max-width: 1600px;
            }

            .settings-sidebar {
                width: 320px;
            }

            .settings-nav-item {
                font-size: 11px;
                padding: 14px 20px;
            }

            .settings-content {
                padding: 3rem;
            }

            .cyber-input {
                font-size: 13px;
                padding: 14px;
            }
        }

        /* Extra large screens */
        @media (min-width: 1920px) {
            .settings-modal .panel {
                max-width: 1800px;
            }

            .settings-sidebar {
                width: 360px;
            }

            .settings-content {
                padding: 4rem;
            }
        }


        /* ========== ðŸ¦´ SKELETON LOADERS - BEAST MODE ========== */
        @keyframes skeleton-shimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        @keyframes skeleton-pulse {

            0%,
            100% {
                opacity: 0.4;
            }

            50% {
                opacity: 0.8;
            }
        }

        .skeleton {
            background: linear-gradient(90deg,
                    rgba(99, 102, 241, 0.05) 0%,
                    rgba(99, 102, 241, 0.15) 20%,
                    rgba(129, 140, 248, 0.25) 40%,
                    rgba(99, 102, 241, 0.15) 60%,
                    rgba(99, 102, 241, 0.05) 100%);
            background-size: 200% 100%;
            animation: skeleton-shimmer 1.5s ease-in-out infinite;
            border-radius: 4px;
        }

        .skeleton-dark {
            background: linear-gradient(90deg,
                    rgba(30, 30, 40, 0.6) 0%,
                    rgba(50, 50, 70, 0.8) 20%,
                    rgba(70, 70, 100, 0.6) 40%,
                    rgba(50, 50, 70, 0.8) 60%,
                    rgba(30, 30, 40, 0.6) 100%);
            background-size: 200% 100%;
            animation: skeleton-shimmer 1.8s ease-in-out infinite;
            border-radius: 4px;
        }

        .skeleton-pulse {
            animation: skeleton-pulse 1.5s ease-in-out infinite;
        }

        /* Message Skeleton */
        .skeleton-message {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 16px;
            background: rgba(10, 10, 15, 0.6);
            border: 1px solid rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .skeleton-message-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .skeleton-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
        }

        .skeleton-line {
            height: 12px;
            border-radius: 6px;
        }

        .skeleton-line-short {
            width: 30%;
        }

        .skeleton-line-medium {
            width: 60%;
        }

        .skeleton-line-long {
            width: 90%;
        }

        .skeleton-line-full {
            width: 100%;
        }

        /* Chat History Skeleton */
        .skeleton-chat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .skeleton-chat-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .skeleton-chat-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        /* Settings Panel Skeleton */
        .skeleton-settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .skeleton-toggle {
            width: 48px;
            height: 24px;
            border-radius: 9999px;
        }

        /* Card Skeleton */
        .skeleton-card {
            background: rgba(10, 10, 15, 0.8);
            border: 1px solid rgba(99, 102, 241, 0.15);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .skeleton-card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .skeleton-card-image {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            flex-shrink: 0;
        }

        /* Grid Skeleton */
        .skeleton-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
        }

        .skeleton-grid-item {
            height: 120px;
            border-radius: 12px;
        }

        /* Typing Indicator Skeleton */
        .skeleton-typing {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 16px;
        }

        .skeleton-typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(99, 102, 241, 0.6);
            animation: skeleton-pulse 1.2s ease-in-out infinite;
        }

        .skeleton-typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .skeleton-typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Processing Skeleton with Glow */
        .skeleton-processing {
            position: relative;
            overflow: hidden;
        }

        .skeleton-processing::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(99, 102, 241, 0.3),
                    transparent);
            animation: skeleton-shimmer 1.2s ease-in-out infinite;
        }

        /* File Upload Skeleton */
        .skeleton-file {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(10, 10, 15, 0.6);
            border: 1px dashed rgba(99, 102, 241, 0.3);
            border-radius: 8px;
        }

        .skeleton-file-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
    "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js",
    "firebase/": "https://esm.sh/firebase@^12.7.0/"
  }
}
</script>
    <link rel="stylesheet" href="./index.css">
</head>

<body class="flex flex-col lg:flex-row overflow-hidden">
    <div class="cyber-grid"></div>
    <div class="noise-overlay"></div>
    <div class="ambient-glow"></div>
    <div class="scan-line"></div>

    <div id="auth-container" class="fixed inset-0 z-[100] flex items-center justify-center bg-black">
        <div class="w-full max-w-sm p-8 auth-panel cut-corner relative">
            <div class="hud-border-tl"></div>
            <div class="hud-border-tr"></div>
            <div class="hud-border-bl"></div>
            <div class="hud-border-br"></div>
            <div class="text-center mb-8">
                <div
                    class="w-16 h-16 bg-indigo-500/10 border border-indigo-500/30 flex items-center justify-center mx-auto mb-4 cut-corner">
                    <i data-lucide="shield-check" class="text-indigo-400 w-8 h-8"></i>
                </div>
                <h1 class="text-2xl font-black text-white tracking-[0.2em] uppercase">Operator Access</h1>
                <p class="text-indigo-400/50 font-mono text-[9px] tracking-[0.3em] mt-2">SECURE_LINK_V2.5.0</p>
            </div>
            <form id="auth-form" class="space-y-6">
                <div class="space-y-6">
                    <div class="relative">
                        <input type="email" id="auth-email"
                            class="w-full bg-transparent border-b border-white/10 py-3 text-sm font-mono text-white focus:outline-none focus:border-indigo-500 transition-colors"
                            placeholder="OPERATOR_EMAIL" required>
                    </div>
                    <div class="relative">
                        <input type="password" id="auth-password"
                            class="w-full bg-transparent border-b border-white/10 py-3 text-sm font-mono text-white focus:outline-none focus:border-indigo-500 transition-colors"
                            placeholder="ACCESS_KEY" required>
                    </div>
                </div>
                <div id="auth-error"
                    class="hidden p-3 bg-red-500/10 border border-red-500/30 text-red-500 text-[10px] font-mono text-center">
                </div>
                <div id="auth-progress" class="hidden space-y-2">
                    <div class="flex justify-between text-[9px] font-mono text-indigo-400">
                        <span>VERIFYING...</span>
                        <span id="auth-percent">0%</span>
                    </div>
                    <div class="h-1 w-full bg-indigo-950 overflow-hidden">
                        <div id="auth-bar" class="h-full bg-indigo-500 transition-all duration-300"></div>
                    </div>
                </div>
                <button type="submit" id="auth-submit-btn"
                    class="w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-mono text-xs font-black uppercase tracking-[0.2em] cut-corner-br transition-all hover:shadow-[0_0_20px_rgba(99,102,241,0.4)]">
                    Establish Uplink
                </button>
                <button type="button" id="toggle-auth-mode"
                    class="w-full text-[9px] font-mono text-white/30 hover:text-indigo-400 transition-colors uppercase tracking-widest text-center">
                    [ Request Credentials ]
                </button>

                <!-- OAuth Divider -->
                <div class="relative my-6">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-white/10"></div>
                    </div>
                    <div class="relative flex justify-center text-[9px]">
                        <span class="px-4 bg-[#0a0a0f] text-white/30 font-mono uppercase tracking-widest">Or Continue
                            With</span>
                    </div>
                </div>

                <!-- OAuth Buttons -->
                <div class="space-y-3">
                    <button type="button" onclick="signInWithGoogle()"
                        class="w-full py-3 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/20 text-white font-mono text-xs uppercase tracking-widest transition-all flex items-center justify-center gap-3 group">
                        <svg class="w-4 h-4" viewBox="0 0 24 24">
                            <path fill="#4285F4"
                                d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                            <path fill="#34A853"
                                d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                            <path fill="#FBBC05"
                                d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                            <path fill="#EA4335"
                                d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                        </svg>
                        <span class="group-hover:text-white/90">Google</span>
                    </button>

                    <button type="button" onclick="signInWithGitHub()"
                        class="w-full py-3 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/20 text-white font-mono text-xs uppercase tracking-widest transition-all flex items-center justify-center gap-3 group">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                        </svg>
                        <span class="group-hover:text-white/90">GitHub</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="sidebar-backdrop"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-40 opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden"
        onclick="toggleSidebar()"></div>

    <aside id="sidebar"
        class="sidebar-bg h-full flex flex-col w-72 shrink-0 z-50 fixed lg:relative transition-transform duration-300 left-0 top-0 bottom-0">
        <div class="p-6 border-b border-white/5 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 bg-indigo-600 flex items-center justify-center cut-corner shadow-lg shadow-indigo-500/20">
                    <i data-lucide="cpu" class="text-white w-5 h-5"></i>
                </div>
                <div>
                    <h1 class="font-black text-sm tracking-widest text-white leading-none">KAI OS</h1>
                    <span
                        class="text-[9px] font-mono text-emerald-500/60 uppercase tracking-widest mt-1 block">Operational</span>
                </div>
            </div>
            <button onclick="toggleSidebar()" class="lg:hidden text-white/40 hover:text-white"><i data-lucide="x"
                    class="w-5 h-5"></i></button>
        </div>

        <div class="flex-1 overflow-y-auto custom-scrollbar p-5 space-y-8">
            <button onclick="newChat()"
                class="w-full flex items-center justify-between px-4 py-4 bg-white/5 hover:bg-indigo-500/10 border border-white/10 hover:border-indigo-500/40 text-white transition-all group cut-corner-br">
                <span class="text-[10px] font-black uppercase tracking-widest">New Operation</span>
                <i data-lucide="plus" class="w-4 h-4 text-indigo-400"></i>
            </button>

            <div class="space-y-4">
                <div
                    class="px-2 flex items-center justify-between text-[9px] font-black text-white/30 uppercase tracking-[0.3em]">
                    <span>Management</span>
                    <button onclick="openSettings()" class="hover:text-indigo-400 transition-colors"
                        title="Settings (Ctrl+,)">
                        <i data-lucide="settings" class="w-3 h-3 hover:rotate-90 transition-transform"></i>
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="exportHistory()"
                        class="flex items-center justify-center gap-2 py-3 bg-white/5 hover:bg-white/10 border border-white/5 text-[9px] font-mono text-indigo-300 uppercase tracking-widest transition-all">
                        <i data-lucide="download" class="w-3 h-3"></i> Export
                    </button>
                    <button onclick="clearAllHistory()"
                        class="flex items-center justify-center gap-2 py-3 bg-red-500/5 hover:bg-red-500/10 border border-red-500/10 text-[9px] font-mono text-red-400 uppercase tracking-widest transition-all">
                        <i data-lucide="trash-2" class="w-3 h-3"></i> Purge
                    </button>
                </div>
            </div>

            <div class="space-y-4">
                <div
                    class="px-2 flex items-center justify-between text-[9px] font-black text-white/30 uppercase tracking-[0.3em]">
                    <span>Telemetry</span>
                </div>
                <div class="space-y-4 bg-black/40 p-4 border border-white/5 rounded-sm">
                    <div class="space-y-2">
                        <div class="flex justify-between text-[8px] font-mono text-indigo-400/70">
                            <span>NEURAL_LOAD</span>
                            <span id="stat-cpu">0%</span>
                        </div>
                        <div class="h-1 bg-white/5 w-full">
                            <div id="bar-cpu"
                                class="h-full bg-indigo-500 shadow-[0_0_8px_rgba(99,102,241,0.5)] w-0 transition-all duration-1000">
                            </div>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-[8px] font-mono text-emerald-400/70">
                            <span>MEM_STACK</span>
                            <span id="stat-ram">0%</span>
                        </div>
                        <div class="h-1 bg-white/5 w-full">
                            <div id="bar-ram"
                                class="h-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)] w-0 transition-all duration-1000">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <div class="px-2 text-[9px] font-black text-white/30 uppercase tracking-[0.3em]">Session Logs</div>
                <div id="chat-history-list" class="space-y-1"></div>
            </div>
        </div>

        <div class="p-5 border-t border-white/5 bg-black/60">
            <button onclick="window.signOut()"
                class="w-full flex items-center justify-center gap-2 py-3 text-[10px] text-red-500/50 hover:text-red-400 transition-colors uppercase tracking-widest font-mono">
                <i data-lucide="power" class="w-3 h-3"></i> Disconnect
            </button>
        </div>
    </aside>

    <main id="main-interface"
        class="flex-1 flex flex-col relative h-full min-w-0 opacity-0 transition-opacity duration-1000">
        <header
            class="h-16 border-b border-white/5 flex items-center justify-between px-6 bg-black/80 backdrop-blur-xl z-30 sticky top-0 w-full">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="lg:hidden p-2 text-white/60 hover:text-white"><i
                        data-lucide="menu" class="w-5 h-5"></i></button>
                <div class="flex flex-col">
                    <div class="flex items-center gap-3">
                        <span class="status-dot active"></span>
                        <span class="text-xs font-black text-white uppercase tracking-[0.2em]">Intel Core</span>
                    </div>
                    <span id="session-id-display"
                        class="text-[9px] font-mono text-indigo-400/40 uppercase pl-5">IDLE</span>
                </div>
            </div>
            <div class="flex items-center gap-6">
                <button onclick="window.toggleOverlayMode()"
                    class="flex items-center gap-2 px-3 py-1.5 bg-white/5 hover:bg-white/10 border border-white/5 hover:border-white/20 transition-all group cut-corner">
                    <i data-lucide="minimize-2"
                        class="w-3 h-3 text-white/50 group-hover:text-white transition-colors"></i>
                    <span
                        class="text-[8px] font-mono text-white/50 group-hover:text-white uppercase tracking-widest hidden md:inline">Mini
                        Mode</span>
                </button>
                <div class="hidden md:flex items-center gap-2 px-3 py-1.5 bg-indigo-500/10 border border-indigo-500/20">
                    <i data-lucide="shield" class="w-3 h-3 text-indigo-400"></i>
                    <span class="text-[8px] font-mono text-indigo-300 tracking-widest">TLS_ENCRYPTED</span>
                </div>
                <div class="w-10 h-10 cut-corner bg-indigo-500/10 border border-indigo-500/30 p-1 overflow-hidden">
                    <img id="user-avatar-img"
                        src="https://api.dicebear.com/7.x/bottts/svg?seed=KAI&backgroundColor=transparent"
                        class="w-full h-full opacity-80 object-cover rounded-sm" alt="User">
                </div>
            </div>
        </header>

        <div id="chat-container" class="flex-1 overflow-y-auto px-6 md:px-12 lg:px-32 py-8 custom-scrollbar">
            <div id="welcome-screen" class="min-h-full flex flex-col items-center justify-center p-6">
                <div class="max-w-4xl w-full text-center space-y-12">
                    <div class="space-y-6 relative">
                        <div
                            class="inline-block px-4 py-1.5 bg-amber-500/10 border border-amber-500/30 cut-corner text-[9px] font-mono text-amber-500 font-black tracking-[0.4em] uppercase mb-4">
                            System Version 2.5.0_PRO
                        </div>
                        <div
                            class="w-24 h-24 bg-indigo-500/5 border border-indigo-500/20 mx-auto flex items-center justify-center cut-corner relative mb-8">
                            <div
                                class="absolute inset-0 border border-indigo-500/10 scale-125 rounded-full animate-pulse">
                            </div>
                            <i data-lucide="cpu" class="w-10 h-10 text-indigo-400"></i>
                        </div>
                        <h2
                            class="text-4xl md:text-7xl font-black text-white tracking-tighter uppercase italic opacity-90 leading-none">
                            KAI <span class="text-indigo-600">INTEL</span>
                        </h2>
                        <div
                            class="flex justify-center gap-8 text-[9px] font-mono text-indigo-400/40 uppercase tracking-[0.3em]">
                            <span>SYSLOG_CLEAR</span>
                            <span>CPU_STABLE</span>
                            <span>NEURAL_READY</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="setSuggested('Perform market volatility analysis')"
                            class="group p-6 bg-white/5 hover:bg-indigo-500/10 border border-white/5 hover:border-indigo-500/30 transition-all cut-corner text-left backdrop-blur-sm">
                            <i data-lucide="activity"
                                class="w-6 h-6 text-indigo-400/50 group-hover:text-indigo-400 transition-colors mb-4"></i>
                            <p class="text-[10px] font-black text-white/70 uppercase leading-relaxed tracking-widest">
                                Market Analysis</p>
                        </button>
                        <button onclick="setSuggested('Generate tactical UI mockup')"
                            class="group p-6 bg-white/5 hover:bg-emerald-500/10 border border-white/5 hover:border-emerald-500/30 transition-all cut-corner text-left backdrop-blur-sm">
                            <i data-lucide="layers"
                                class="w-6 h-6 text-emerald-400/50 group-hover:text-emerald-400 transition-colors mb-4"></i>
                            <p class="text-[10px] font-black text-white/70 uppercase leading-relaxed tracking-widest">
                                Visual Synthesis</p>
                        </button>
                        <button onclick="setSuggested('Decrypt complex architectural concepts')"
                            class="group p-6 bg-white/5 hover:bg-violet-500/10 border border-white/5 hover:border-violet-500/30 transition-all cut-corner text-left backdrop-blur-sm">
                            <i data-lucide="database"
                                class="w-6 h-6 text-violet-400/50 group-hover:text-violet-400 transition-colors mb-4"></i>
                            <p class="text-[10px] font-black text-white/70 uppercase leading-relaxed tracking-widest">
                                Data Mining</p>
                        </button>
                    </div>
                </div>
            </div>
            <div id="messages-list" class="space-y-8 pb-10 max-w-5xl mx-auto w-full hidden flex-col"></div>
        </div>

        <div class="p-6 md:p-10 bg-gradient-to-t from-black via-black/90 to-transparent sticky bottom-0 w-full z-40">
            <div class="max-w-4xl mx-auto tactical-console cut-corner-top overflow-hidden">
                <div id="attachment-area" class="px-5 pt-5 hidden flex-wrap gap-2"></div>
                <div class="p-4 flex gap-4 items-end">
                    <input type="file" id="fileInput" class="hidden" onchange="handleFileUpload(event)">
                    <button onclick="document.getElementById('fileInput').click()"
                        class="h-12 w-12 flex items-center justify-center text-white/30 hover:text-indigo-400 hover:bg-white/5 transition-colors rounded-sm shrink-0">
                        <i data-lucide="paperclip" class="w-6 h-6"></i>
                    </button>
                    <div class="flex-1 py-2">
                        <textarea id="messageInput" rows="1"
                            class="console-input text-sm leading-relaxed max-h-48 custom-scrollbar"
                            placeholder="Awaiting Input..."></textarea>
                    </div>
                    <div class="flex items-center gap-2 pb-1">
                        <button id="voice-btn" onclick="toggleVoice()"
                            class="h-12 w-12 flex items-center justify-center text-white/30 hover:text-red-500 transition-colors">
                            <i data-lucide="mic" class="w-6 h-6"></i>
                        </button>
                        <button onclick="sendMessage()"
                            class="h-12 px-8 bg-indigo-600 hover:bg-indigo-500 text-white font-mono text-[10px] font-black uppercase tracking-[0.3em] transition-all hover:shadow-[0_0_20px_rgba(99,102,241,0.4)] cut-corner-br">
                            Execute
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- CANVAS SIDEBAR -->
    <div id="canvas-backdrop"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[80] opacity-0 pointer-events-none transition-opacity duration-300"
        onclick="closeCanvas()"></div>

    <aside id="canvas-panel"
        class="fixed top-0 right-0 h-full w-full md:w-[600px] lg:w-[700px] bg-[#0a0a0f]/98 backdrop-blur-xl border-l border-indigo-500/20 z-[90] transform translate-x-full transition-transform duration-300 ease-out flex flex-col shadow-2xl">
        <!-- Canvas Header -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-white/10 bg-black/40">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-indigo-500/20 rounded-lg flex items-center justify-center">
                    <i data-lucide="file-text" class="w-4 h-4 text-indigo-400"></i>
                </div>
                <div>
                    <div id="canvas-title" class="text-sm font-bold text-white">Canvas Draft</div>
                    <div class="text-[9px] font-mono text-white/40 uppercase tracking-widest">DOCUMENT_BUFFER</div>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="copyCanvasContent()"
                    class="flex items-center gap-1.5 px-3 py-1.5 text-[9px] font-mono text-white/60 hover:text-white bg-white/5 hover:bg-white/10 border border-white/10 rounded transition-all uppercase tracking-widest">
                    <i data-lucide="copy" class="w-3 h-3"></i> Copy
                </button>
                <button onclick="downloadCanvasContent()"
                    class="flex items-center gap-1.5 px-3 py-1.5 text-[9px] font-mono text-white/60 hover:text-white bg-white/5 hover:bg-white/10 border border-white/10 rounded transition-all uppercase tracking-widest">
                    <i data-lucide="download" class="w-3 h-3"></i> Download
                </button>
                <button onclick="closeCanvas()"
                    class="p-2 text-white/40 hover:text-white hover:bg-white/10 rounded transition-all ml-2">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
        </div>

        <!-- Canvas Content -->
        <div id="canvas-content" class="flex-1 overflow-y-auto p-6 custom-scrollbar">
            <div class="prose prose-invert prose-sm max-w-none">
                <!-- Content will be injected here -->
            </div>
        </div>

        <!-- Canvas Footer -->
        <div class="px-6 py-3 border-t border-white/5 bg-black/40 flex items-center justify-between">
            <div class="text-[9px] font-mono text-white/30 uppercase tracking-widest">
                <span id="canvas-char-count">0</span> characters
            </div>
            <div class="flex items-center gap-2">
                <span class="text-[9px] font-mono text-indigo-400/60 uppercase tracking-widest">Canvas Mode</span>
                <div class="w-2 h-2 rounded-full bg-indigo-500 animate-pulse"></div>
            </div>
        </div>
    </aside>

    <!-- ðŸš€ ULTRA-VIOLET WILD BOOTUP OVERLAY -->
    <div id="bootup-overlay"
        class="fixed inset-0 bg-[#020202] z-[9999] flex items-center justify-center overflow-hidden font-mono hidden">
        <!-- Static/Noise/Glow layers -->
        <div
            class="absolute inset-0 opacity-[0.15] pointer-events-none z-[100] mix-blend-overlay bg-[url('https://grainy-gradients.vercel.app/noise.svg')]">
        </div>
        <div id="violet-glitch-layer" class="absolute inset-0 bg-indigo-600/10 opacity-0 pointer-events-none z-[60]">
        </div>
        <div
            class="absolute inset-0 bg-gradient-to-tr from-indigo-900/20 via-transparent to-purple-900/20 pointer-events-none">
        </div>

        <!-- Stage 0: Neural Link Initiation -->
        <div id="boot-stage-0" class="boot-stage absolute inset-0 flex items-center justify-center z-50">
            <div class="flex flex-col items-center">
                <div class="text-indigo-500 text-6xl sm:text-8xl font-black italic mb-4 animate-[pulse_0.5s_infinite]">
                    INITIALIZING_NEURAL_LINK</div>
                <div class="h-[3px] w-0 bg-indigo-500 shadow-[0_0_30px_#6366f1]" id="warning-bar"></div>
                <div class="text-indigo-300 font-bold tracking-[0.8em] mt-6 opacity-0 uppercase" id="warning-text">
                    Attempting_Deep_Sync...</div>
            </div>
        </div>

        <!-- Stage 1: KAI INTEL Dominance -->
        <div id="boot-stage-1" class="boot-stage flex flex-col items-center px-4 relative hidden">
            <div class="relative flex flex-col items-center">
                <div class="relative flex items-baseline gap-2 sm:gap-6 py-4">
                    <h1
                        class="boot-title-kai glitch-text-wild text-7xl sm:text-9xl font-black italic tracking-tighter text-white opacity-0 scale-150 blur-lg transition-all duration-300">
                        KAI</h1>
                    <h1
                        class="boot-title-intel glitch-text-wild text-7xl sm:text-9xl font-black italic tracking-tighter text-indigo-500 opacity-0 scale-150 blur-lg transition-all duration-300">
                        INTEL</h1>
                </div>
                <div
                    class="boot-subtitle-wild text-[12px] sm:text-sm tracking-[1.5em] sm:tracking-[2.2em] uppercase text-center mt-6 text-indigo-400/80 opacity-0 transition-opacity duration-500">
                    COGNITIVE_ARRAY_ONLINE</div>
            </div>
        </div>

        <!-- Stage 2: Operator Identification -->
        <div id="boot-stage-2" class="boot-stage absolute inset-0 hidden">
            <div class="absolute inset-0 flex items-center justify-center">
                <div class="relative w-[500px] h-[500px] flex items-center justify-center scale-75 sm:scale-100">
                    <div
                        class="absolute inset-0 border-2 border-indigo-500/10 rounded-full animate-[spin_3s_linear_infinite]">
                    </div>
                    <div
                        class="absolute inset-8 border-[2px] border-purple-500/30 border-t-transparent rounded-full animate-[spin_1.5s_ease-in-out_infinite]">
                    </div>
                    <div class="absolute inset-16 border border-blue-500/20 rounded-full animate-pulse"></div>

                    <div
                        class="w-56 h-56 bg-indigo-950/20 rounded-full flex flex-col items-center justify-center backdrop-blur-xl border border-indigo-500/30 relative">
                        <div class="absolute -inset-4 border border-indigo-500/10 rounded-full animate-ping"></div>
                        <span
                            class="text-[10px] font-black text-indigo-400 tracking-[0.4em] mb-2 uppercase">Sync_Progress</span>
                        <span class="text-4xl font-black text-white glow-text-indigo" id="boot-percent">00%</span>
                        <div class="mt-3 flex flex-col items-center">
                            <span class="text-[8px] text-indigo-300/60 font-mono"
                                id="boot-operator-label">SCANNING_OPERATOR...</span>
                            <span class="text-[11px] text-white font-bold tracking-widest mt-1 opacity-0"
                                id="boot-username-reveal">GUEST_USER</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stage 3: Data Flood (Violet) -->
        <div id="boot-stage-3"
            class="boot-stage absolute inset-0 hidden flex flex-col items-center justify-center bg-[#020205]">
            <div class="w-full max-w-5xl px-6 relative z-10">
                <div class="flex items-center gap-4 mb-4">
                    <h3 class="text-2xl sm:text-4xl font-black text-indigo-500 italic tracking-[0.1em]">
                        CONSTRUCTING_WORKSPACE</h3>
                    <div class="h-[1px] flex-1 bg-gradient-to-r from-indigo-500 to-transparent"></div>
                </div>
                <div
                    class="bg-black/80 border-l-4 border-indigo-600 p-8 sm:p-14 relative overflow-hidden shadow-[0_0_50px_rgba(99,102,241,0.05)] backdrop-blur-md">
                    <div id="boot-terminal-wild"
                        class="space-y-1.5 h-72 sm:h-96 overflow-hidden font-mono text-indigo-400 text-sm sm:text-base">
                    </div>
                </div>
            </div>
        </div>

        <!-- Stage 4: WELCOME HOME / UPLINK -->
        <div id="boot-stage-4" class="boot-stage absolute inset-0 hidden flex items-center justify-center bg-black">
            <div id="flash-violet" class="absolute inset-0 bg-indigo-600 opacity-0 z-50 pointer-events-none"></div>
            <div class="flex flex-col items-center px-4">
                <div id="seized-box"
                    class="p-10 sm:p-24 border-[12px] border-indigo-600 relative overflow-hidden transform scale-150 opacity-0 transition-all duration-300 shadow-[0_0_100px_rgba(99,102,241,0.2)]">
                    <h2 class="text-6xl sm:text-9xl font-black italic tracking-tighter text-white">WELCOME</h2>
                    <div class="absolute bottom-4 right-6 text-indigo-400 font-bold text-xl sm:text-3xl tracking-widest uppercase"
                        id="welcome-username">OPERATOR</div>
                </div>
                <div class="mt-12 text-indigo-400 font-bold tracking-[2.5em] uppercase text-sm opacity-0" id="op-id-v2">
                    UPLINK_ESTABLISHED_SUCCESSFULLY</div>
            </div>
        </div>
    </div>

    <style>
        .glow-text-indigo {
            text-shadow: 0 0 10px rgba(99, 102, 241, 0.8), 0 0 20px rgba(99, 102, 241, 0.4);
        }

        .glitch-text-wild {
            text-shadow: 0.1em 0 0 rgba(99, 102, 241, 0.9), -0.1em -0.05em 0 rgba(168, 85, 247, 0.6), 0.05em 0.1em 0 rgba(59, 130, 246, 0.6);
            animation: boot-glitch-intense 150ms infinite;
        }

        @keyframes boot-glitch-intense {
            0% {
                transform: translate(0);
            }

            20% {
                transform: translate(-3px, 3px);
            }

            40% {
                transform: translate(-3px, -3px);
            }

            60% {
                transform: translate(3px, 3px);
            }

            80% {
                transform: translate(3px, -3px);
            }

            100% {
                transform: translate(0);
            }
        }

        .shake-wild {
            animation: shake-wild-anim 0.1s infinite !important;
        }

        @keyframes shake-wild-anim {
            0% {
                transform: translate(0);
            }

            25% {
                transform: translate(-10px, 10px);
            }

            50% {
                transform: translate(10px, -10px);
            }

            75% {
                transform: translate(-10px, -10px);
            }

            100% {
                transform: translate(10px, 10px);
            }
        }
    </style>

    <!-- ========== SETTINGS MODAL ========== -->
    <div id="settings-modal" class="settings-modal">
        <div class="backdrop" onclick="closeSettings()"></div>
        <div class="panel">
            <!-- Mobile Close Button -->
            <button onclick="closeSettings()" class="settings-mobile-close" aria-label="Close Settings">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            <!-- Settings Sidebar -->
            <aside class="settings-sidebar">
                <div class="p-6 border-b border-indigo-900/30">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 bg-indigo-600 rounded flex items-center justify-center border border-indigo-400/50 shadow-[0_0_15px_rgba(99,102,241,0.3)]">
                            <i data-lucide="cpu" class="text-white w-6 h-6"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold tracking-tighter text-white">KAI OS</h1>
                            <div class="flex items-center gap-1.5">
                                <div class="w-1.5 h-1.5 bg-green-500 rounded-full status-dot shadow-[0_0_5px_#22c55e]">
                                </div>
                                <span
                                    class="text-[10px] text-green-500 font-bold uppercase tracking-widest">SETTINGS</span>
                            </div>
                        </div>
                    </div>
                </div>

                <nav class="flex-1 overflow-y-auto p-4 space-y-2 scrollbar-hide">
                    <div class="text-[10px] text-zinc-500 font-bold mb-4 ml-2 uppercase tracking-[0.2em]">Management
                    </div>

                    <button class="settings-nav-item active" data-tab="profile" onclick="switchSettingsTab('profile')">
                        <div class="flex items-center gap-3">
                            <i data-lucide="user" class="w-4 h-4"></i>
                            <span>Operator Profile</span>
                        </div>
                        <i data-lucide="chevron-right" class="w-3 h-3 opacity-50"></i>
                    </button>

                    <button class="settings-nav-item" data-tab="notifications"
                        onclick="switchSettingsTab('notifications')">
                        <div class="flex items-center gap-3">
                            <i data-lucide="bell" class="w-4 h-4"></i>
                            <span>Neural Alerts</span>
                        </div>
                    </button>

                    <div class="text-[10px] text-zinc-500 font-bold mt-8 mb-4 ml-2 uppercase tracking-[0.2em]">Systems
                    </div>


                    <button class="settings-nav-item" data-tab="uplink" onclick="switchSettingsTab('uplink')">
                        <div class="flex items-center gap-3">
                            <i data-lucide="zap" class="w-4 h-4"></i>
                            <span>Uplink Config</span>
                        </div>
                    </button>
                    <button class="settings-nav-item" data-tab="models" onclick="switchSettingsTab('models')">
                        <div class="flex items-center gap-3">
                            <i data-lucide="brain" class="w-4 h-4"></i>
                            <span>Model Preferences</span>
                        </div>
                    </button>


                    <div class="text-[10px] text-zinc-500 font-bold mt-8 mb-4 ml-2 uppercase tracking-[0.2em]">Advanced
                    </div>

                    <button class="settings-nav-item" data-tab="apikeys" onclick="switchSettingsTab('apikeys')">
                        <div class="flex items-center gap-3">
                            <i data-lucide="key" class="w-4 h-4"></i>
                            <span>API Key Management</span>
                        </div>
                    </button>
                    <button class="settings-nav-item" data-tab="language" onclick="switchSettingsTab('language')">
                        <div class="flex items-center gap-3">
                            <i data-lucide="globe" class="w-4 h-4"></i>
                            <span>Language & Locale</span>
                        </div>
                    </button>

                    <div class="pt-12 mt-auto">
                        <button onclick="closeSettings()"
                            class="w-full flex items-center gap-3 p-3 text-zinc-500 hover:text-white hover:bg-white/5 transition-colors rounded-sm group">
                            <i data-lucide="x" class="w-4 h-4 group-hover:rotate-90 transition-transform"></i>
                            <span class="text-xs font-bold uppercase tracking-widest">Close Settings</span>
                        </button>
                    </div>
                </nav>

                <div class="p-4 border-t border-indigo-900/30 bg-[#020202]">
                    <div class="text-[10px] text-zinc-600 flex justify-between items-center">
                        <span>SYS_VER_2.5.0_PRO</span>
                        <i data-lucide="terminal" class="w-3 h-3"></i>
                    </div>
                </div>
            </aside>

            <!-- Settings Content -->
            <main class="settings-content relative">
                <!-- Background Grid -->
                <div
                    class="absolute inset-0 bg-[linear-gradient(rgba(15,23,42,0.1)_1px,transparent_1px),linear-gradient(90deg,rgba(15,23,42,0.1)_1px,transparent_1px)] bg-[size:32px_32px] pointer-events-none opacity-20">
                </div>

                <!-- Header -->
                <div class="flex items-center justify-between mb-8 relative z-10">
                    <div class="flex items-center gap-4">
                        <div class="w-2 h-2 bg-indigo-500 rounded-full"></div>
                        <h2 id="settings-tab-title" class="text-sm font-bold uppercase tracking-[0.3em] text-white">
                            PROFILE</h2>
                        <div
                            class="px-2 py-0.5 bg-indigo-500/10 border border-indigo-500/20 text-[10px] text-indigo-400 font-bold rounded-sm">
                            SID-<span id="settings-user-id">176634</span>
                        </div>
                    </div>
                </div>

                <!-- Content Sections -->
                <div id="settings-sections" class="max-w-3xl relative z-10">
                    <!-- Profile Section - Linked to KAI -->
                    <div id="section-profile" class="settings-section section-fade-in space-y-8">
                        <!-- Note about linked fields -->
                        <div
                            class="flex items-center gap-3 p-3 bg-indigo-500/10 border border-indigo-500/20 rounded-sm">
                            <i data-lucide="link" class="w-5 h-5 text-indigo-400"></i>
                            <p class="text-[11px] text-indigo-300">These settings are linked to KAI. Changes will affect
                                how the assistant addresses and responds to you.</p>
                        </div>

                        <div class="flex items-start gap-8">
                            <div class="relative group">
                                <input type="file" id="avatar-upload" accept="image/*" class="hidden"
                                    onchange="uploadAvatar(event)">
                                <div onclick="document.getElementById('avatar-upload').click()"
                                    class="w-32 h-32 border border-indigo-500/20 bg-indigo-950/20 overflow-hidden relative cursor-pointer">
                                    <img id="settings-avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=KAI"
                                        alt="Profile"
                                        class="w-full h-full object-cover opacity-70 group-hover:scale-105 transition-transform">
                                    <div
                                        class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity">
                                        <i data-lucide="camera" class="text-white w-6 h-6"></i>
                                    </div>
                                </div>
                                <div class="mt-4 text-center">
                                    <span onclick="document.getElementById('avatar-upload').click()"
                                        class="text-[10px] font-bold text-indigo-500 uppercase tracking-widest cursor-pointer hover:underline">Change
                                        Avatar</span>
                                </div>
                            </div>
                            <div class="flex-1 space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="space-y-1">
                                        <label
                                            class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest flex items-center gap-2">
                                            <i data-lucide="user" class="w-3 h-3 text-indigo-500"></i>
                                            Your Name
                                        </label>
                                        <input type="text" id="settings-name" placeholder="Krish" class="cyber-input">
                                        <p class="text-[9px] text-zinc-600">KAI will address you by this name</p>
                                    </div>
                                    <div class="space-y-1">
                                        <label
                                            class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest flex items-center gap-2">
                                            <i data-lucide="at-sign" class="w-3 h-3 text-indigo-500"></i>
                                            Nickname (Optional)
                                        </label>
                                        <input type="text" id="settings-nickname" placeholder="Boss, Chief, etc."
                                            class="cyber-input">
                                        <p class="text-[9px] text-zinc-600">Casual name KAI can use</p>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label
                                        class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest flex items-center gap-2">
                                        <i data-lucide="mail" class="w-3 h-3 text-indigo-500"></i>
                                        Email
                                    </label>
                                    <input type="email" id="settings-email" placeholder="you@example.com"
                                        class="cyber-input">
                                </div>
                            </div>
                        </div>

                        <!-- AI Personalization Section -->
                        <div class="border-t border-indigo-900/20 pt-6 space-y-4">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-white flex items-center gap-2">
                                <i data-lucide="brain" class="w-4 h-4 text-indigo-500"></i>
                                AI Personalization
                            </h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="space-y-1">
                                    <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">
                                        Preferred Response Style
                                    </label>
                                    <select id="settings-response-style" class="cyber-input">
                                        <option value="professional">Professional & Formal</option>
                                        <option value="casual" selected>Casual & Friendly</option>
                                        <option value="brief">Brief & Concise</option>
                                        <option value="detailed">Detailed & Thorough</option>
                                        <option value="technical">Technical & Precise</option>
                                    </select>
                                </div>
                                <div class="space-y-1">
                                    <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">
                                        Response Language
                                    </label>
                                    <select id="settings-response-language" class="cyber-input">
                                        <option value="english" selected>English</option>
                                        <option value="hindi">Hindi</option>
                                        <option value="hinglish">Hinglish (Mix)</option>
                                        <option value="spanish">Spanish</option>
                                        <option value="french">French</option>
                                    </select>
                                </div>
                            </div>
                            <div class="space-y-1">
                                <label
                                    class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest flex items-center gap-2">
                                    <i data-lucide="stars" class="w-3 h-3 text-indigo-500"></i>
                                    Your Interests (comma-separated)
                                </label>
                                <input type="text" id="settings-interests"
                                    placeholder="coding, gaming, anime, music, AI" class="cyber-input">
                                <p class="text-[9px] text-zinc-600">KAI will tailor responses based on your interests
                                </p>
                            </div>
                            <div class="space-y-1">
                                <label
                                    class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest flex items-center gap-2">
                                    <i data-lucide="file-text" class="w-3 h-3 text-indigo-500"></i>
                                    About You (Bio)
                                </label>
                                <textarea id="settings-bio" class="cyber-input min-h-[100px]"
                                    placeholder="Tell KAI about yourself..."></textarea>
                                <p class="text-[9px] text-zinc-600">KAI will remember this context in conversations</p>
                            </div>
                        </div>

                        <div class="border-t border-indigo-900/20 pt-6 flex justify-between items-center">
                            <span class="text-[10px] text-zinc-500">Changes are saved and synced with KAI</span>
                            <button onclick="saveProfile()"
                                class="cut-corner bg-indigo-600 hover:bg-indigo-500 px-8 py-3 text-xs font-bold uppercase tracking-widest flex items-center gap-2 shadow-[0_0_20px_rgba(99,102,241,0.2)] transition-all active:scale-95">
                                <i data-lucide="save" class="w-4 h-4"></i>
                                Save & Sync
                            </button>
                        </div>
                    </div>


                    <!-- Notifications Section -->
                    <div id="section-notifications" class="settings-section hidden section-fade-in space-y-8">
                        <div class="space-y-2">
                            <h3 class="text-xs font-bold uppercase tracking-[0.2em] mb-4 text-white">Neural Event
                                Channels</h3>
                            <div class="space-y-3">
                                <div
                                    class="p-4 border border-zinc-900 bg-black flex items-center justify-between hover:border-zinc-800 transition-colors">
                                    <div class="flex items-center gap-4">
                                        <div class="p-2 bg-zinc-900 rounded-sm"><i data-lucide="alert-triangle"
                                                class="w-4 h-4 text-red-500"></i></div>
                                        <div>
                                            <div class="text-[10px] font-bold uppercase tracking-widest text-white">
                                                Critical System Alerts</div>
                                            <p class="text-[9px] text-zinc-600 uppercase tracking-tight">Visual and
                                                haptic feedback for hardware failure or security breaches.</p>
                                        </div>
                                    </div>
                                    <button id="notif-critical-toggle" onclick="toggleSetting('notif-critical')"
                                        class="settings-toggle on">
                                        <div class="thumb"></div>
                                    </button>
                                </div>
                                <div
                                    class="p-4 border border-zinc-900 bg-black flex items-center justify-between hover:border-zinc-800 transition-colors">
                                    <div class="flex items-center gap-4">
                                        <div class="p-2 bg-zinc-900 rounded-sm"><i data-lucide="message-square"
                                                class="w-4 h-4 text-indigo-500"></i></div>
                                        <div>
                                            <div class="text-[10px] font-bold uppercase tracking-widest text-white">
                                                Operator Comms</div>
                                            <p class="text-[9px] text-zinc-600 uppercase tracking-tight">Voice-to-text
                                                notifications for incoming tactical messages.</p>
                                        </div>
                                    </div>
                                    <button id="notif-comms-toggle" onclick="toggleSetting('notif-comms')"
                                        class="settings-toggle on">
                                        <div class="thumb"></div>
                                    </button>
                                </div>
                                <div
                                    class="p-4 border border-zinc-900 bg-black flex items-center justify-between hover:border-zinc-800 transition-colors">
                                    <div class="flex items-center gap-4">
                                        <div class="p-2 bg-zinc-900 rounded-sm"><i data-lucide="info"
                                                class="w-4 h-4 text-cyan-500"></i></div>
                                        <div>
                                            <div class="text-[10px] font-bold uppercase tracking-widest text-white">
                                                Status Updates</div>
                                            <p class="text-[9px] text-zinc-600 uppercase tracking-tight">Routine
                                                telemetry reports and background sync status.</p>
                                        </div>
                                    </div>
                                    <button id="notif-status-toggle" onclick="toggleSetting('notif-status')"
                                        class="settings-toggle">
                                        <div class="thumb"></div>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-6 pt-4">
                            <div class="space-y-2">
                                <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Alert
                                    Priority Threshold</label>
                                <select id="alert-priority"
                                    class="w-full bg-black border border-zinc-800 p-3 text-[10px] font-bold text-zinc-400 uppercase tracking-widest focus:outline-none focus:border-indigo-500">
                                    <option>LEVEL_1 - MINIMAL</option>
                                    <option selected>LEVEL_2 - STANDARD</option>
                                    <option>LEVEL_3 - HIGH_ONLY</option>
                                </select>
                            </div>
                            <div class="space-y-2">
                                <label
                                    class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Notification
                                    Sound</label>
                                <select id="notif-sound"
                                    class="w-full bg-black border border-zinc-800 p-3 text-[10px] font-bold text-zinc-400 uppercase tracking-widest focus:outline-none focus:border-indigo-500">
                                    <option>KAI_SYSTEM_CHIME</option>
                                    <option>NEURAL_TAP_PULSE</option>
                                    <option>TACTICAL_BUZZ_SHORT</option>
                                </select>
                            </div>
                        </div>
                    </div>


                    <!-- Uplink Section -->
                    <div id="section-uplink" class="settings-section hidden section-fade-in space-y-8">
                        <div class="space-y-4">
                            <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Primary Uplink
                                Node</label>
                            <div class="space-y-3">
                                <div class="p-4 border flex items-center gap-4 cursor-pointer transition-all bg-indigo-600/10 border-indigo-500/50"
                                    onclick="selectUplink(this)">
                                    <div class="p-3 text-indigo-500 bg-indigo-500/10"><i data-lucide="globe"
                                            class="w-5 h-5"></i></div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-0.5">
                                            <span
                                                class="text-[10px] font-bold uppercase tracking-widest text-white">Local_Dev_Server
                                                (localhost)</span>
                                            <span
                                                class="text-[8px] text-green-500 font-bold uppercase tracking-tighter">CONNECTED</span>
                                        </div>
                                        <p class="text-[9px] text-zinc-600 uppercase tracking-tight leading-none">Local
                                            development server. Fastest response times.</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-[10px] font-mono text-zinc-500 mb-0.5">&lt;1ms</div>
                                        <div class="text-[8px] text-zinc-700 uppercase font-bold tracking-widest">
                                            Latency</div>
                                    </div>
                                </div>
                                <div class="p-4 border flex items-center gap-4 cursor-pointer transition-all bg-black border-zinc-900 hover:border-zinc-700"
                                    onclick="selectUplink(this)">
                                    <div class="p-3 text-zinc-600 bg-zinc-900"><i data-lucide="server"
                                            class="w-5 h-5"></i></div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-0.5">
                                            <span
                                                class="text-[10px] font-bold uppercase tracking-widest text-white">Render_Cloud_API
                                                (Production)</span>
                                        </div>
                                        <p class="text-[9px] text-zinc-600 uppercase tracking-tight leading-none">Cloud
                                            hosted API with global redundancy.</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-[10px] font-mono text-zinc-500 mb-0.5">~120ms</div>
                                        <div class="text-[8px] text-zinc-700 uppercase font-bold tracking-widest">
                                            Latency</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="p-6 bg-indigo-600/5 border border-indigo-500/20 relative overflow-hidden group">
                            <div
                                class="absolute -right-8 -bottom-8 opacity-5 group-hover:rotate-12 transition-transform duration-1000">
                                <i data-lucide="zap" class="w-40 h-40"></i>
                            </div>
                            <div class="relative z-10 flex items-center justify-between">
                                <div>
                                    <h4 class="text-xs font-bold uppercase tracking-widest mb-1 text-white">API
                                        Connection Test</h4>
                                    <p class="text-[10px] text-zinc-500 uppercase">Verify connectivity and measure
                                        response latency.</p>
                                </div>
                                <button onclick="testConnection()"
                                    class="px-4 py-2 border border-indigo-500 text-indigo-400 text-[10px] font-bold uppercase tracking-widest hover:bg-indigo-600 hover:text-white transition-all">Test
                                    Connection</button>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="flex-1 p-4 bg-zinc-950 border border-zinc-900">
                                <h5 class="text-[10px] font-bold uppercase tracking-widest mb-2 text-white">LLM Model
                                </h5>
                                <select id="llm-model"
                                    class="w-full bg-black border border-zinc-800 p-2 text-[10px] font-mono text-zinc-400 focus:outline-none focus:border-indigo-500 uppercase">
                                    <option selected>Gemini-2.0-Flash (Default)</option>
                                    <option>Gemini-2.0-Flash-Thinking</option>
                                    <option>Llama-3.3-70B</option>
                                    <option>Groq-Mixtral</option>
                                </select>
                            </div>
                            <div class="flex-1 p-4 bg-zinc-950 border border-zinc-900">
                                <h5 class="text-[10px] font-bold uppercase tracking-widest mb-2 text-white">Response
                                    Mode</h5>
                                <select id="response-mode"
                                    class="w-full bg-black border border-zinc-800 p-2 text-[10px] font-mono text-zinc-400 focus:outline-none focus:border-indigo-500 uppercase">
                                    <option selected>Fast (Default)</option>
                                    <option>Thinking Mode</option>
                                    <option>Creative Mode</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Model Preferences Section -->
                    <div id="section-models" class="settings-section hidden section-fade-in space-y-8">
                        <div class="space-y-6">
                            <div class="space-y-2">
                                <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Default AI
                                    Model</label>
                                <select id="default-model"
                                    class="w-full bg-black border border-zinc-800 p-3 text-[10px] font-bold text-zinc-400 uppercase tracking-widest focus:outline-none focus:border-indigo-500">
                                    <option value="gemini-2.0-flash" selected>Gemini-2.0-Flash (Recommended)</option>
                                    <option value="gemini-2.0-flash-thinking">Gemini-2.0-Flash-Thinking</option>
                                    <option value="llama-3.3-70b">Llama-3.3-70B (Groq)</option>
                                    <option value="mixtral-8x7b">Mixtral-8x7B (Groq)</option>
                                    <option value="command-r-plus">Command-R-Plus (Cohere)</option>
                                </select>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <label
                                        class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Temperature</label>
                                    <span id="temp-value" class="text-[10px] text-indigo-400 font-bold">0.7</span>
                                </div>
                                <input type="range" id="temperature-slider" min="0" max="2" step="0.1" value="0.7"
                                    oninput="updateSliderValue('temp-value', this.value)"
                                    class="w-full h-1 bg-zinc-900 appearance-none cursor-pointer accent-indigo-500">
                                <p class="text-[8px] text-zinc-600 uppercase">Lower = More focused. Higher = More
                                    creative.</p>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Max
                                        Tokens</label>
                                    <span id="tokens-value" class="text-[10px] text-indigo-400 font-bold">4096</span>
                                </div>
                                <input type="range" id="max-tokens-slider" min="256" max="8192" step="256" value="4096"
                                    oninput="updateSliderValue('tokens-value', this.value)"
                                    class="w-full h-1 bg-zinc-900 appearance-none cursor-pointer accent-indigo-500">
                                <p class="text-[8px] text-zinc-600 uppercase">Maximum response length in tokens.</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 border bg-indigo-600/5 border-indigo-500/30">
                                <div class="flex items-center gap-3 mb-2">
                                    <i data-lucide="sparkles" class="w-4 h-4 text-indigo-400"></i>
                                    <span class="text-xs font-bold uppercase tracking-widest text-white">Smart
                                        Routing</span>
                                    <span
                                        class="ml-auto text-[8px] bg-indigo-500/20 text-indigo-400 px-1.5 py-0.5 rounded-sm">ON</span>
                                </div>
                                <p class="text-[9px] text-zinc-500 uppercase leading-normal">Auto-select best model
                                    based on query complexity.</p>
                            </div>
                            <div class="p-4 border bg-zinc-950 border-zinc-900">
                                <div class="flex items-center gap-3 mb-2">
                                    <i data-lucide="brain" class="w-4 h-4 text-zinc-500"></i>
                                    <span class="text-xs font-bold uppercase tracking-widest text-white">Thinking
                                        Mode</span>
                                </div>
                                <p class="text-[9px] text-zinc-500 uppercase leading-normal">Show step-by-step reasoning
                                    for complex queries.</p>
                            </div>
                        </div>
                    </div>


                    <!-- API Keys Section -->
                    <div id="section-apikeys" class="settings-section hidden section-fade-in space-y-8">
                        <div class="p-4 border-l-2 border-amber-500 bg-amber-500/5 mb-6">
                            <h4 class="text-[10px] text-amber-500 font-bold uppercase tracking-widest mb-2">Security
                                Notice</h4>
                            <p class="text-[10px] text-zinc-400 uppercase leading-relaxed">API keys are stored locally
                                in your browser and encrypted. They are never sent to our servers.</p>
                        </div>
                        <div class="space-y-6">
                            <div class="space-y-2">
                                <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Groq API
                                    Key</label>
                                <div class="flex gap-2">
                                    <input type="password" id="groq-key" placeholder="gsk_..."
                                        class="flex-1 cyber-input font-mono text-[11px]">
                                    <button onclick="toggleKeyVisibility('groq-key')"
                                        class="px-3 border border-zinc-800 hover:border-indigo-500 text-zinc-500 hover:text-indigo-400 transition-all">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Google
                                    Gemini API Key</label>
                                <div class="flex gap-2">
                                    <input type="password" id="gemini-key" placeholder="AIza..."
                                        class="flex-1 cyber-input font-mono text-[11px]">
                                    <button onclick="toggleKeyVisibility('gemini-key')"
                                        class="px-3 border border-zinc-800 hover:border-indigo-500 text-zinc-500 hover:text-indigo-400 transition-all">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">OpenAI API
                                    Key</label>
                                <div class="flex gap-2">
                                    <input type="password" id="openai-key" placeholder="sk-..."
                                        class="flex-1 cyber-input font-mono text-[11px]">
                                    <button onclick="toggleKeyVisibility('openai-key')"
                                        class="px-3 border border-zinc-800 hover:border-indigo-500 text-zinc-500 hover:text-indigo-400 transition-all">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Cohere API
                                    Key</label>
                                <div class="flex gap-2">
                                    <input type="password" id="cohere-key" placeholder="..."
                                        class="flex-1 cyber-input font-mono text-[11px]">
                                    <button onclick="toggleKeyVisibility('cohere-key')"
                                        class="px-3 border border-zinc-800 hover:border-indigo-500 text-zinc-500 hover:text-indigo-400 transition-all">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="border-t border-indigo-900/20 pt-6 flex justify-end gap-3">
                            <button onclick="clearApiKeys()"
                                class="px-6 py-2 border border-zinc-800 text-zinc-500 text-[10px] font-bold uppercase tracking-widest hover:border-red-500 hover:text-red-400 transition-all">Clear
                                All</button>
                            <button onclick="saveApiKeys()"
                                class="cut-corner bg-indigo-600 hover:bg-indigo-500 px-6 py-2 text-[10px] font-bold uppercase tracking-widest flex items-center gap-2 transition-all">
                                <i data-lucide="save" class="w-3 h-3"></i>
                                Save Keys
                            </button>
                        </div>
                    </div>

                    <!-- Language Section -->
                    <div id="section-language" class="settings-section hidden section-fade-in space-y-8">
                        <div class="space-y-6">
                            <div class="space-y-2">
                                <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Interface
                                    Language</label>
                                <select id="ui-language"
                                    class="w-full bg-black border border-zinc-800 p-3 text-[10px] font-bold text-zinc-400 uppercase tracking-widest focus:outline-none focus:border-indigo-500">
                                    <option value="en" selected>English (US)</option>
                                    <option value="en-gb">English (UK)</option>
                                    <option value="hi">à¤¹à¤¿à¤‚à¤¦à¥€ (Hindi)</option>
                                </select>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">AI Response
                                    Language</label>
                                <select id="ai-language"
                                    class="w-full bg-black border border-zinc-800 p-3 text-[10px] font-bold text-zinc-400 uppercase tracking-widest focus:outline-none focus:border-indigo-500">
                                    <option value="auto" selected>Auto-Detect Input</option>
                                    <option value="en">Always English</option>
                                    <option value="hi">Always Hindi</option>
                                </select>
                                <p class="text-[8px] text-zinc-600 uppercase">Auto-detect will match the language you
                                    type in.</p>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Date & Time
                                    Format</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <select id="date-format"
                                        class="bg-black border border-zinc-800 p-3 text-[10px] font-bold text-zinc-400 uppercase tracking-widest focus:outline-none focus:border-indigo-500">
                                        <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                    </select>
                                    <select id="time-format"
                                        class="bg-black border border-zinc-800 p-3 text-[10px] font-bold text-zinc-400 uppercase tracking-widest focus:outline-none focus:border-indigo-500">
                                        <option value="12h">12-Hour (AM/PM)</option>
                                        <option value="24h">24-Hour</option>
                                    </select>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label
                                    class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Timezone</label>
                                <select id="timezone"
                                    class="w-full bg-black border border-zinc-800 p-3 text-[10px] font-bold text-zinc-400 uppercase tracking-widest focus:outline-none focus:border-indigo-500">
                                    <option value="auto" selected>Auto-Detect (IST - UTC+5:30)</option>
                                    <option value="UTC">UTC</option>
                                    <option value="America/New_York">America - New York (EST)</option>
                                    <option value="Europe/London">Europe - London (GMT)</option>
                                    <option value="Asia/Tokyo">Asia - Tokyo (JST)</option>
                                </select>
                            </div>
                        </div>
                        <div class="border-t border-indigo-900/20 pt-6 flex justify-end">
                            <button onclick="saveLanguageSettings()"
                                class="cut-corner bg-indigo-600 hover:bg-indigo-500 px-6 py-2 text-[10px] font-bold uppercase tracking-widest flex items-center gap-2 transition-all">
                                <i data-lucide="save" class="w-3 h-3"></i>
                                Apply Changes
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="notification-area" class="fixed top-20 right-6 w-80 z-[200] space-y-3 pointer-events-none"></div>

    <!-- PROJECT INTELLIGENCE MODE - Inline Script -->
    <script>
        // Project Mode Detection & Canvas Launch
        window.detectAndLaunchProject = async function (message) {
            const API_URL = 'http://localhost:5000/api/v1';

            console.log('[PROJECT MODE] Starting detection for:', message);

            // Show thinking indicator
            const messagesList = document.getElementById('messages-list');
            if (messagesList) {
                const thinkingHTML = `
                    <div id="project-thinking" class="msg-block" style="animation: messageAppear 0.3s ease;">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-600 to-indigo-600 flex items-center justify-center flex-shrink-0">
                                <i data-lucide="brain" class="w-5 h-5 text-white animate-pulse"></i>
                            </div>
                            <div class="flex-1">
                                <div class="text-xs font-mono text-white/40 mb-2">ðŸš€ PROJECT INTELLIGENCE</div>
                                <div class="flex items-center gap-3">
                                    <div class="flex gap-1">
                                        <div class="w-2 h-2 bg-purple-500 rounded-full animate-pulse"></div>
                                        <div class="w-2 h-2 bg-purple-500 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
                                        <div class="w-2 h-2 bg-purple-500 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
                                    </div>
                                    <span id="project-thinking-text" class="text-sm text-white/80">Analyzing project intent...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                messagesList.insertAdjacentHTML('beforeend', thinkingHTML);
                if (typeof lucide !== 'undefined') lucide.createIcons();
                messagesList.scrollTop = messagesList.scrollHeight;
            }

            try {
                // Step 1: Detect intent
                const detectResp = await fetch(`${API_URL}/project/detect`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, history: [] })
                });
                const detection = await detectResp.json();

                console.log('[PROJECT MODE] Detection result:', detection);

                // Update thinking
                const thinkingText = document.getElementById('project-thinking-text');
                if (thinkingText) {
                    thinkingText.textContent = `Project detected: ${detection.suggested_type || 'analyzing...'}`;
                }

                // Step 2: Generate plan if confident
                if (detection.is_project && detection.confidence >= 0.6) {
                    if (thinkingText) thinkingText.textContent = 'Generating project plan...';

                    const planResp = await fetch(`${API_URL}/project/plan`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ description: message, user_profile: {} })
                    });
                    const planData = await planResp.json();

                    console.log('[PROJECT MODE] Plan generated:', planData);

                    // Remove thinking
                    const thinking = document.getElementById('project-thinking');
                    if (thinking) {
                        thinking.style.opacity = '0';
                        setTimeout(() => thinking.remove(), 300);
                    }

                    // Add message to chat
                    const plan = planData.plan;
                    const chatHTML = `
                        <div class="msg-block user">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center">
                                    <i data-lucide="user" class="w-4 h-4 text-white/60"></i>
                                </div>
                                <div class="text-xs font-mono text-white/40">YOU</div>
                            </div>
                            <div class="text-sm text-white/90">${message}</div>
                        </div>
                        <div class="msg-block assistant">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-600 to-indigo-600 flex items-center justify-center">
                                    <i data-lucide="rocket" class="w-4 h-4 text-white"></i>
                                </div>
                                <div class="text-xs font-mono text-purple-400">PROJECT MODE</div>
                            </div>
                            <div class="space-y-3">
                                <div class="text-sm text-white/90">
                                    I've created a structured project plan for <strong>${plan.title}</strong>! ðŸš€
                                </div>
                                <div class="bg-black/30 border border-purple-500/20 rounded-lg p-4">
                                    <div class="grid grid-cols-2 gap-4 text-xs">
                                        <div><div class="text-white/40 mb-1">Type</div><div class="text-white/80">${plan.project_type}</div></div>
                                        <div><div class="text-white/40 mb-1">Tasks</div><div class="text-white/80">${plan.tasks.length} steps</div></div>
                                        <div><div class="text-white/40 mb-1">Milestones</div><div class="text-white/80">${plan.milestones.length} phases</div></div>
                                        <div><div class="text-white/40 mb-1">Progress</div><div class="text-purple-400 font-bold">${plan.progress_percent || 0}%</div></div>
                                    </div>
                                </div>
                                <div class="text-xs text-white/60">Tech Stack: ${plan.tech_stack.map(t => `<span class="px-2 py-1 bg-purple-500/20 border border-purple-500/30 rounded text-purple-300">${t}</span>`).join(' ')}</div>
                               <div class="p-3 bg-purple-500/10 border border-purple-500/20 rounded-lg">
                                    <div class="text-xs text-white/90 mb-2 font-semibold">ðŸ“‹ Next Steps:</div>
                                    ${plan.tasks.slice(0, 5).map((t, i) => `<div class="text-xs text-white/70 mb-1">â€¢ ${t.text}</div>`).join('')}
                                    ${plan.tasks.length > 5 ? `<div class="text-xs text-white/50 mt-2">...and ${plan.tasks.length - 5} more tasks</div>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                    messagesList.insertAdjacentHTML('beforeend', chatHTML);
                    if (typeof lucide !== 'undefined') lucide.createIcons();
                    messagesList.scrollTop = messagesList.scrollHeight;

                } else {
                    // Not a project - remove thinking and fall back to normal chat
                    const thinking = document.getElementById('project-thinking');
                    if (thinking) thinking.remove();
                    console.log('[PROJECT MODE] Not a project or low confidence');
                    // Send to normal chat instead
                    const input = document.getElementById('messageInput');
                    if (input) {
                        input.value = message;
                        window.sendMessage();
                    }
                }

            } catch (error) {
                console.error('[PROJECT MODE] Error:', error);
                const thinking = document.getElementById('project-thinking');
                if (thinking) thinking.remove();
                // Fall back to normal chat
                const input = document.getElementById('messageInput');
                if (input) {
                    input.value = message;
                    window.sendMessage();
                }
            }
        };

        console.log('[PROJECT MODE] âœ… Detection system loaded');

        // ==================== CANVAS AUTO-LAUNCH ====================
        // Watch for PROJECT_CANVAS marker in chat responses
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                mutation.addedNodes.forEach((node) => {
                    if (node.nodeType === 1) {
                        const html = node.innerHTML || '';
                        if (html.includes('<!--PROJECT_CANVAS:')) {
                            console.log('[PROJECT MODE] Canvas trigger detected!');

                            // Extract JSON from comment
                            const match = html.match(/<!--PROJECT_CANVAS:(.+?)--> /);
                            if (match) {
                                try {
                                    const plan = JSON.parse(match[1]);
                                    console.log('[PROJECT MODE] Opening canvas with plan:', plan.title);

                                    // Remove the hidden comment from display
                                    node.innerHTML = html.replace(/<!--PROJECT_CANVAS:.+?-->/g, '');

                                    // Open canvas after short delay
                                    setTimeout(() => {
                                        openProjectCanvas(plan);
                                    }, 500);
                                } catch (e) {
                                    console.error('[PROJECT MODE] Failed to parse plan:', e);
                                }
                            }
                        }
                    }
                });
            });
        });

        // Start observing messages list
        setTimeout(() => {
            const messagesList = document.getElementById('messages-list');
            if (messagesList) {
                observer.observe(messagesList, { childList: true, subtree: true });
                console.log('[PROJECT MODE] Canvas auto-launch observer active');
            }
        }, 2000);

        // Canvas open function - CLEAN MINIMAL DESIGN with Kai Input
        function openProjectCanvas(plan) {
            const existing = document.getElementById('project-canvas');
            if (existing) existing.remove();

            const tasks = plan.tasks || [];
            const techStack = plan.tech_stack || [];

            const canvasHTML = `
                <div id="project-canvas" class="fixed inset-0 z-[500] flex items-center justify-center bg-black/90 backdrop-blur-sm" style="animation: fadeIn 0.3s ease;">
                    <style>
                        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                        #project-canvas .task-check:hover { background: rgba(99,102,241,0.2); }
                        #project-canvas .task-check.done { background: rgba(34,197,94,0.2); border-color: #22c55e; }
                        #project-canvas input:focus { outline: none; border-color: #6366f1; }
                    </style>
                    
                    <div class="w-full max-w-3xl max-h-[85vh] bg-[#0f0f14] border border-white/10 rounded-xl overflow-hidden flex flex-col shadow-2xl">
                        
                        <!-- Header - Simple -->
                        <div class="p-5 border-b border-white/10">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h1 class="text-xl font-semibold text-white">${plan.title || 'Your Project'}</h1>
                                    <p class="text-sm text-white/50 mt-1">${plan.project_type ? plan.project_type.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()) + ' Project' : ''}</p>
                                </div>
                                <button onclick="document.getElementById('project-canvas').remove()" class="p-1.5 hover:bg-white/10 rounded text-white/40 hover:text-white">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 5l8 8M13 5l-8 8"/></svg>
                                </button>
                            </div>
                            
                            <!-- Tech Stack -->
                            <div class="flex gap-2 flex-wrap">
                                ${techStack.map(t => `<span class="px-2.5 py-1 bg-indigo-500/10 border border-indigo-500/20 rounded text-xs text-indigo-300">${t}</span>`).join('')}
                            </div>
                        </div>
                        
                        <!-- Tasks List - Scrollable -->
                        <div class="flex-1 overflow-y-auto p-5" id="canvas-tasks">
                            <div class="text-xs text-white/40 uppercase tracking-wide mb-3">Tasks (${tasks.length})</div>
                            <div class="space-y-2">
                                ${tasks.map((t, i) => `
                                    <div class="flex items-start gap-3 p-3 bg-white/5 rounded-lg hover:bg-white/[0.07] transition-colors group">
                                        <button class="task-check w-5 h-5 border border-white/20 rounded flex-shrink-0 mt-0.5 flex items-center justify-center transition-all" 
                                                onclick="this.classList.toggle('done'); this.innerHTML = this.classList.contains('done') ? '<svg width=12 height=12 stroke=#22c55e fill=none stroke-width=2><path d=\\'M3 6l3 3 5-5\\'/></svg>' : ''">
                                        </button>
                                        <div class="flex-1">
                                            <span class="text-sm text-white/80">${t.text}</span>
                                            <div class="text-[10px] text-white/30 mt-1 uppercase">${t.layer || ''}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Kai Input - Ask for help -->
                        <div class="p-4 border-t border-white/10 bg-black/30">
                            <div class="text-xs text-white/40 mb-2">ðŸ’¬ Ask Kai about this project</div>
                            <div class="flex gap-2">
                                <input type="text" 
                                       id="canvas-kai-input"
                                       placeholder="How do I start with the first task?" 
                                       class="flex-1 bg-white/5 border border-white/10 rounded-lg px-4 py-2.5 text-sm text-white placeholder-white/30">
                                <button onclick="sendCanvasMessage()" 
                                        class="px-4 py-2.5 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm text-white font-medium transition-colors">
                                    Ask
                                </button>
                            </div>
                            <div id="canvas-response" class="mt-3 text-sm text-white/70 hidden"></div>
                        </div>
                        
                        <!-- Simple Footer -->
                        <div class="px-5 py-3 border-t border-white/10 flex justify-between items-center bg-black/20">
                            <span class="text-xs text-white/30">Phase: ${plan.current_phase || 'Planning'}</span>
                            <button onclick="document.getElementById('project-canvas').remove()" 
                                    class="px-4 py-2 bg-white/10 hover:bg-white/15 rounded-lg text-sm text-white/70 transition-colors">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', canvasHTML);

            // Focus the input
            setTimeout(() => {
                const input = document.getElementById('canvas-kai-input');
                if (input) input.focus();
            }, 100);
        }

        // Send message from canvas to Kai
        async function sendCanvasMessage() {
            const input = document.getElementById('canvas-kai-input');
            const responseDiv = document.getElementById('canvas-response');
            if (!input || !input.value.trim()) return;

            const message = input.value.trim();
            input.value = '';
            responseDiv.classList.remove('hidden');
            responseDiv.innerHTML = '<span class="text-indigo-400">Thinking...</span>';

            try {
                const response = await fetch('http://localhost:5000/api/v1/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `[Project Help] ${message}`,
                        session_id: 'canvas-session'
                    })
                });
                const data = await response.json();
                responseDiv.innerHTML = data.response || 'No response';
            } catch (e) {
                responseDiv.innerHTML = '<span class="text-red-400">Error getting response</span>';
            }
        }

        // Enter key support for canvas input
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.target.id === 'canvas-kai-input') {
                sendCanvasMessage();
            }
        });

        window.openProjectCanvas = openProjectCanvas;
    </script>

    <script src="index.tsx" type="module"></script>
    <script>
        // Initialize Lucide icons
        if (typeof lucide !== 'undefined') lucide.createIcons();

        // Open Settings - navigate directly to the settings React app
        function openSettings() {
            window.location.href = './kai-os---tactical-settings/index.html';
        }

        // Export as global function
        window.openSettings = openSettings;

        const input = document.getElementById('messageInput');
        if (input) {
            input.addEventListener('input', () => {
                input.style.height = 'auto';
                input.style.height = Math.min(input.scrollHeight, 200) + 'px';
            });
            // SIMPLIFIED: Let backend SmartTrigger handle all detection
            input.addEventListener('keydown', async (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    window.sendMessage();
                }
            });
        }

        // Project mode is now handled purely in chat - no canvas needed
        console.log('[PROJECT MODE] âœ… AI-powered project planning active (in-chat display)');
    </script>

</body>

</html>